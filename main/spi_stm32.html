<!-- HTML header for doxygen 1.9.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CMSIS-Driver_STM32: SPI</title>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="tabs.js"></script>
<script type="text/javascript" src="footer.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="extra_stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="extra_navtree.css" rel="stylesheet" type="text/css"/>
<link href="extra_search.css" rel="stylesheet" type="text/css"/>
<link href="extra_tabs.css" rel="stylesheet" type="text/css"/>
<link href="version.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../version.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 55px;">
  <td id="projectlogo" style="padding: 1.5em;"><a href="https://www.keil.arm.com/cmsis" target="_blank"><img alt="Logo" src="cmsis_logo_white_small.png"/</a></td>
  <td style="padding-left: 1em; padding-bottom: 1em;padding-top: 1em;">
   <div id="projectname">CMSIS-Driver_STM32
   &#160;<span id="projectnumber"><script type="text/javascript">
     <!--
     writeHeader.call(this);
     writeVersionDropdown.call(this, "CMSIS-Driver_STM32");
     //-->
    </script>
   </span>
   </div>
   <div id="projectbrief">CMSIS Drivers for STMicroelectronics STM32 Series devices</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
  <ul class="tablist">
    <script type="text/javascript">
      writeComponentTabs.call(this);
    </script>
  </ul>
</div>
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('spi_stm32.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">SPI </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md24"></a>
Revision History</h1>
<ul>
<li>Version 3.0<ul>
<li>Initial release</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
Requirements</h1>
<p>This driver requires the STM32 device specific <b>HAL</b> and <b>STM32CubeMX</b> (CubeMX) initialization code generator. The driver instance is mapped to hardware as shown in the table below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">CMSIS Driver Instance   </th><th class="markdownTableHeadLeft">STM32 Hardware Resource    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Driver_SPI1   </td><td class="markdownTableBodyLeft">SPI1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Driver_SPI2   </td><td class="markdownTableBodyLeft">SPI2    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Driver_SPI3   </td><td class="markdownTableBodyLeft">SPI3    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Driver_SPI4   </td><td class="markdownTableBodyLeft">SPI4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Driver_SPI5   </td><td class="markdownTableBodyLeft">SPI5    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Driver_SPI6   </td><td class="markdownTableBodyLeft">SPI6    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">Driver_SPI7   </td><td class="markdownTableBodyLeft">SPI7    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">Driver_SPI8   </td><td class="markdownTableBodyLeft">SPI8   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md26"></a>
Deviations</h1>
<p>This driver has the following deviations from the CMSIS-Driver specification:</p>
<p><b>Conceptual</b> deviations:</p><ul>
<li>CubeMX generated initialization code (function MX_SPIn_Init) already configures the peripheral. Power, clocks, pins, and interrupts are enabled after execution of initialization that executes in <code>main.c</code>.</li>
</ul>
<p><b>Functional</b> deviations:</p><ul>
<li>Initialize:<ul>
<li>depends on the code generated by CubeMX.</li>
<li>does not initialize the pins.</li>
</ul>
</li>
<li>Uninitialize:<ul>
<li>does not de-initialize the pins.</li>
</ul>
</li>
<li>PowerControl:<ul>
<li>depends on the code generated by CubeMX.</li>
<li>low-power mode is not supported by HAL.</li>
</ul>
</li>
<li>Send:<ul>
<li>maximum number of data items supported by HAL with a single send request is 65535.</li>
</ul>
</li>
<li>Receive:<ul>
<li>maximum number of data items supported by HAL with a single receive request is 65535.</li>
</ul>
</li>
<li>Transfer:<ul>
<li>maximum number of data items supported by HAL with a single transfer request is 65535.</li>
</ul>
</li>
<li>Control:<ul>
<li>for control code ARM_SPI_MODE_MASTER the functionality depends on HAL_RCCEx_GetPeriphCLKFreq function. If HAL_RCCEx_GetPeriphCLKFreq function does not provide particular peripheral instance clock frequency then bus speed will not be reconfigured but it will be left unchanged (as configured in CubeMX) and the function will return ARM_DRIVER_OK status code.</li>
<li>for control codes: ARM_SPI_SET_BUS_SPEED and ARM_SPI_GET_BUS_SPEED the functionality depends on HAL_RCCEx_GetPeriphCLKFreq function. If HAL_RCCEx_GetPeriphCLKFreq function does not provide particular peripheral instance clock frequency then bus speed will not be reconfigured but it will be left unchanged (as configured in CubeMX) and the function will return ARM_DRIVER_ERROR_UNSUPPORTED error code.</li>
<li>changes are not effective after this function but when data transfer operation is started (for example: changing Phase or Polarity will change clock line state when data operation is started and not after this function finishes).</li>
</ul>
</li>
<li>GetStatus:<ul>
<li>mode fault and data lost cannot be detected until data transfer operation is started.</li>
</ul>
</li>
<li>SignalEvent:<ul>
<li>mode fault and data lost detection does not work until data transfer operation is started.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md27"></a>
CubeMX Configuration</h1>
<p>This driver requires the following configuration in CubeMX:</p>
<ul>
<li><b>clock</b>: <b>SPI</b> peripheral clock.</li>
<li><b>peripheral</b>: <b>SPI</b> peripheral configured as <b>Full-Duplex Master/Slave</b> and <b>Parameter Setting</b> configured as desired.</li>
<li><b>pins</b>: <b>SPI MISO</b>, <b>MOSI</b>, <b>SCK</b> and <b>NSS pins</b>.</li>
<li><b>DMA</b>: optional <b>DMA</b> configuration for transfers.</li>
<li><b>interrupts</b>: enabled <b>SPI interrupts</b> and <b>IRQ handlers</b> that <b>Call HAL handlers</b> and enabled <b>DMA interrupts</b> and <b>IRQ handlers</b> that <b>Call HAL handlers</b> if <b>DMA</b> is used.</li>
</ul>
<blockquote class="doxtable">
<p>&zwj;<b>Notes</b></p>
<ul>
<li>configuration information in the <b>MX_Device.h</b> file is based on CubeMX configuration.</li>
<li><b>Hardware</b> or <b>Software Slave Select</b> functionality is only available if <b>NSS pin</b> is configured in the CubeMX with alternate function <b>Hardware NSS Signal</b>.</li>
<li><b>DMA</b> configuration can differ between devices series so configure DMA <b>as required by the used device</b>.</li>
<li>for <b>DMA</b> usage on devices with cache, ensure that data buffers for Send and Receive functions are in <b>non-cacheable memory</b>, or ensure that memory for send is updated (<b>cache clean</b>) before Send function is called and that memory containing received data is updated after the reception finishes (<b>cache invalidate</b>).</li>
<li>some DMA controllers can only access specific memories, so ensure that proper memory is used for the buffers according to the DMA requirement. </li>
</ul>
</blockquote>
<h2><a class="anchor" id="autotoc_md28"></a>
Example</h2>
<h3><a class="anchor" id="autotoc_md29"></a>
Pinout &amp; Configuration tab</h3>
<ol type="1">
<li>In the <b>Pinout view</b> window click on a pin and select it's functionality: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Pin   </th><th class="markdownTableHeadCenter">Functionality    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PF6   </td><td class="markdownTableBodyCenter"><b>SPI5_NSS</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PF7   </td><td class="markdownTableBodyCenter"><b>SPI5_SCK</b>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PF8   </td><td class="markdownTableBodyCenter"><b>SPI5_MISO</b>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PF9   </td><td class="markdownTableBodyCenter"><b>SPI5_MOSI</b>   </td></tr>
</table>
<br  />
</li>
<li><p class="startli">Under <b>Categories</b>: <b>Connectivity</b> select <b>SPI5</b>:</p>
<p class="startli"><b>Mode</b>:</p><ul>
<li>Mode: <b>Full-Duplex Master</b></li>
<li>Hardware NSS Signal: <b>Hardware NSS Output Signal</b></li>
</ul>
<p class="startli"><b>Configuration</b>:</p><ul>
<li>Parameter Settings: as desired</li>
<li>GPIO Settings: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Pin Name   </th><th class="markdownTableHeadCenter">Signal on Pin   </th><th class="markdownTableHeadCenter">Pin Context..   </th><th class="markdownTableHeadCenter">GPIO output..   </th><th class="markdownTableHeadCenter">GPIO mode   </th><th class="markdownTableHeadCenter">GPIO Pull-up/Pull..   </th><th class="markdownTableHeadCenter">Maximum out..   </th><th class="markdownTableHeadCenter">Fast Mode   </th><th class="markdownTableHeadCenter">User Label    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PF6   </td><td class="markdownTableBodyCenter">SPI5_NSS   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">Alternate Function Push Pull   </td><td class="markdownTableBodyCenter">No pull-up and no..   </td><td class="markdownTableBodyCenter"><b>Medium</b>   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PF7   </td><td class="markdownTableBodyCenter">SPI5_SCK   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">Alternate Function Push Pull   </td><td class="markdownTableBodyCenter">No pull-up and no..   </td><td class="markdownTableBodyCenter"><b>Medium</b>   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PF8   </td><td class="markdownTableBodyCenter">SPI5_MISO   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">Alternate Function Push Pull   </td><td class="markdownTableBodyCenter">No pull-up and no..   </td><td class="markdownTableBodyCenter"><b>Medium</b>   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PF9   </td><td class="markdownTableBodyCenter">SPI5_MOSI   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">Alternate Function Push Pull   </td><td class="markdownTableBodyCenter">No pull-up and no..   </td><td class="markdownTableBodyCenter"><b>Medium</b>   </td><td class="markdownTableBodyCenter">n/a   </td><td class="markdownTableBodyCenter">.   </td></tr>
</table>
<br  />
</li>
</ul>
</li>
<li><p class="startli">Under <b>Categories</b>: <b>System Core</b> select <b>DMA</b> (might be different on other device series, or for some peripherals might be BDMA):</p>
<p class="startli"><b>Configuration</b>:</p><ul>
<li><p class="startli">DMA1, DMA2:</p>
<p class="startli">Click on <b>Add</b> button and add DMA Requests as in table below: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">DMA Request   </th><th class="markdownTableHeadCenter">Stream   </th><th class="markdownTableHeadLeft">Direction   </th><th class="markdownTableHeadLeft">Priority    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">SPI5_RX   </td><td class="markdownTableBodyCenter">DMA1 Stream 0   </td><td class="markdownTableBodyLeft">Peripheral to Memory   </td><td class="markdownTableBodyLeft">Low    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">SPI5_TX   </td><td class="markdownTableBodyCenter">DMA1 Stream 1   </td><td class="markdownTableBodyLeft">Memory to Peripheral   </td><td class="markdownTableBodyLeft">Low   </td></tr>
</table>
<p><br  />
</p>
</li>
</ul>
</li>
<li><p class="startli">Under <b>Categories</b>: <b>System Core</b> select <b>NVIC</b>:</p>
<p class="startli"><b>Configuration</b>:</p><ul>
<li>NVIC: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">NVIC Interrupt Table   </th><th class="markdownTableHeadCenter">Enabled   </th><th class="markdownTableHeadCenter">Preemption Priority   </th><th class="markdownTableHeadCenter">Sub Priority    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">DMA1 stream0 global interrupt   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DMA1 stream1 global interrupt   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI5 global interrupt   </td><td class="markdownTableBodyCenter"><b>checked</b>   </td><td class="markdownTableBodyCenter">0   </td><td class="markdownTableBodyCenter">0   </td></tr>
</table>
<br  />
</li>
<li>Code generation: <table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Enabled interrupt table   </th><th class="markdownTableHeadCenter">Select for..   </th><th class="markdownTableHeadCenter">Generate Enable in..   </th><th class="markdownTableHeadCenter">Generate IRQ h..   </th><th class="markdownTableHeadCenter">Call HAL handler    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">DMA1 stream0 global interrupt   </td><td class="markdownTableBodyCenter">unchecked   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">checked    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">DMA1 stream1 global interrupt   </td><td class="markdownTableBodyCenter">unchecked   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">checked    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">SPI5 global interrupt   </td><td class="markdownTableBodyCenter">unchecked   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">checked   </td><td class="markdownTableBodyCenter">checked   </td></tr>
</table>
<br  />
 </li>
</ul>
</li>
</ol>
<h3><a class="anchor" id="autotoc_md30"></a>
Clock Configuration tab</h3>
<ol type="1">
<li>Configure <b>To SPI4,5 (MHz)</b>: <b>100</b></li>
</ol>
<h3><a class="anchor" id="autotoc_md31"></a>
Project Manager tab</h3>
<ol type="1">
<li><p class="startli">Under <b>Advanced Settings</b>:</p>
<p class="startli"><b>Generated Function Calls</b>: </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Generate Code   </th><th class="markdownTableHeadCenter">Function Name   </th><th class="markdownTableHeadCenter">Peripheral Inst..   </th><th class="markdownTableHeadCenter">Do not generate ..   </th><th class="markdownTableHeadCenter">Visibility (Static)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">checked   </td><td class="markdownTableBodyCenter">MX_SPI5_Init   </td><td class="markdownTableBodyCenter">SPI5   </td><td class="markdownTableBodyCenter">unchecked   </td><td class="markdownTableBodyCenter">checked   </td></tr>
</table>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <script type="text/javascript">
        <!--
        writeFooter.call(this);
        //-->
      </script> 
    </li>
  </ul>
</div>
</body>
</html>
